"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const l=require("react"),_=require("prop-types"),b=require("@codemirror/lang-json"),x=require("@uiw/react-codemirror"),A=require("../Field/Field.cjs"),H=require("../Field/FieldLabel.cjs");require("../Field/FieldInput.cjs");const R=require("../Field/FieldHint.cjs"),T=require("../Field/FieldError.cjs");require("../Field/FieldContext.cjs");require("../Field/FieldAction.cjs");const P=require("../Stack/Stack.cjs"),w=require("./JSONInputContainer.cjs"),u=require("./utils/decorationExtension.cjs"),m=n=>n&&typeof n=="object"&&"default"in n?n:{default:n},o=m(l),t=m(_),f=({label:n,value:q,error:h,hint:j,required:C,onChange:O,disabled:g,labelAction:k,...y})=>{const c=l.useRef(),a=l.useRef(null),s=l.useRef(null),p=Boolean(h),I=e=>a.current?.doc?.line(e),J=e=>{const{text:r,to:i}=I(e),d=i-r.trimStart().length;i>d&&s.current?.dispatch({effects:u.addMarks.of([u.lineHighlightMark.range(d,i)])})},N=()=>{const e=a.current?.doc?.length||0;s.current?.dispatch({effects:u.filterMarks.of((r,i)=>i<=0||r>=e)})},F=e=>{const{view:r,state:i}=e;s.current=r,a.current=i,N();const S=b.jsonParseLinter()(r);S.length&&J(i.doc.lineAt(S[0].from).number)},v=(e,r)=>{F(r),O(e)},M=(e,r)=>{s.current=e,a.current=r,F({view:e,state:r})},{setContainer:E}=x.useCodeMirror({value:q,onCreateEditor:M,theme:"dark",onChange:v,editable:!g,container:c.current,extensions:[b.json(),u.markField],basicSetup:{lineNumbers:!0,bracketMatching:!0,closeBrackets:!0,indentOnInput:!0,syntaxHighlighting:!0,highlightSelectionMatches:!0,tabSize:2,defaultCharacterWidth:5}}),L=()=>{g||c.current.children[0].children[1].children[1].focus()};return l.useEffect(()=>{const e=c.current;e&&E(e)},[E,p]),o.default.createElement(A.Field,{error:h,hint:j,required:C},o.default.createElement(P.Stack,{spacing:1},n&&o.default.createElement(H.FieldLabel,{onClick:L,action:k},n),o.default.createElement(w.JSONInputContainer,{ref:c,hasError:p,alignItems:"stretch",fontSize:2,hasRadius:!0,...y}),o.default.createElement(T.FieldError,null),o.default.createElement(R.FieldHint,null)))};f.defaultProps={label:void 0,labelAction:void 0,value:"",error:void 0,hint:void 0,required:!1,disabled:!1,onChange(){}};f.propTypes={label:t.default.string,labelAction:t.default.element,value:t.default.string,error:t.default.oneOfType([t.default.string,t.default.bool]),hint:t.default.oneOfType([t.default.string,t.default.node,t.default.arrayOf(t.default.node)]),required:t.default.bool,disabled:t.default.bool,onChange:t.default.func};exports.JSONInput=f;
