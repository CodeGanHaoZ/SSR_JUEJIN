"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[8056],{83782:function(me,b,t){t.r(b),t.d(b,{default:function(){return le}});var e=t(32735),a=t(88425),S=t(72041),k=t(5636),v=t(84968),A=t(5141),V=t(33348),x=t.n(V),$=t(28356),F=t(17e3),H=t(27649),Z=t(41415),P=t(19406),O=[{name:"name",key:"name",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}],Q=t(60216),n=t.n(Q),y=t(49372),W=t(3594),z=t(29005),p=t(66735),G=t(87933),j=t(4038),Y=t(50563),J=t(72850);const B=({tokenName:l,onClickDelete:s})=>{const{formatMessage:d}=(0,k.useIntl)(),{trackUsage:c}=(0,a.useTracking)();return e.createElement(J.x,{paddingLeft:1,...a.stopPropagation},e.createElement(Y.h,{onClick:()=>{c("willDeleteToken"),s()},label:d({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${l}`}),name:"delete",noBorder:!0,icon:e.createElement(j.default,null)}))};B.propTypes={tokenName:n().string.isRequired,onClickDelete:n().func.isRequired};var K=B,X=t(68625),q=t(83292);const _={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},ee=(0,q.default)(a.Link)`
  svg {
    path {
      fill: ${({theme:l})=>l.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:l})=>l.colors.neutral800};
      }
    }
  }
`,h=({tokenName:l,tokenId:s,buttonType:d,children:c})=>{const{formatMessage:m}=(0,k.useIntl)(),{location:{pathname:g}}=(0,A.useHistory)();return e.createElement(ee,{to:`${g}/${s}`,title:m(_[d],{target:l})},c)};h.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired,buttonType:n().string,children:n().node.isRequired},h.defaultProps={buttonType:"edit"};var I=h;const N=({tokenName:l,tokenId:s})=>e.createElement(I,{tokenName:l,tokenId:s},e.createElement(X.Z,null));N.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};var te=N,ae=t(54894);const w=({tokenName:l,tokenId:s})=>e.createElement(I,{tokenName:l,tokenId:s,buttonType:"read"},e.createElement(ae.default,null));w.propTypes={tokenName:n().string.isRequired,tokenId:n().oneOfType([n().string,n().number]).isRequired};var ne=w;const C=({canDelete:l,canUpdate:s,canRead:d,onClickDelete:c,withBulkActions:m,rows:g})=>{const[{query:r}]=(0,a.useQueryParams)(),[,T]=r.sort.split(":"),{push:f,location:{pathname:D}}=(0,A.useHistory)(),{trackUsage:E}=(0,a.useTracking)(),L=g.sort((o,M)=>{const u=o.name.localeCompare(M.name);return T==="DESC"?-u:u});return e.createElement(W.p,null,L.map(o=>e.createElement(z.Tr,{key:o.id,...(0,a.onRowClick)({fn(){E("willEditTokenFromList"),f(`${D}/${o.id}`)},condition:s})},e.createElement(p.Td,null,e.createElement(y.Z,{textColor:"neutral800",fontWeight:"bold"},o.name)),e.createElement(p.Td,{maxWidth:(0,a.pxToRem)(250)},e.createElement(y.Z,{textColor:"neutral800",ellipsis:!0},o.description)),e.createElement(p.Td,null,e.createElement(y.Z,{textColor:"neutral800"},e.createElement(a.RelativeTime,{timestamp:new Date(o.createdAt)}))),e.createElement(p.Td,null,o.lastUsedAt&&e.createElement(y.Z,{textColor:"neutral800"},e.createElement(a.RelativeTime,{timestamp:new Date(o.lastUsedAt)}))),m&&e.createElement(p.Td,null,e.createElement(G.k,{justifyContent:"end"},s&&e.createElement(te,{tokenName:o.name,tokenId:o.id}),!s&&d&&e.createElement(ne,{tokenName:o.name,tokenId:o.id}),l&&e.createElement(K,{tokenName:o.name,onClickDelete:()=>c(o.id)}))))))};C.defaultProps={canDelete:!1,canUpdate:!1,canRead:!1,onClickDelete(){},rows:[],withBulkActions:!1},C.propTypes={canDelete:n().bool,canUpdate:n().bool,canRead:n().bool,onClickDelete:n().func,rows:n().array,withBulkActions:n().bool};var se=C,oe=()=>{(0,a.useFocusWhenNavigate)();const l=(0,v.useQueryClient)(),{formatMessage:s}=(0,k.useIntl)(),d=(0,a.useNotification)(),{allowedActions:{canCreate:c,canDelete:m,canUpdate:g,canRead:r}}=(0,a.useRBAC)(S.Z.settings["api-tokens"]),{push:T}=(0,A.useHistory)(),{trackUsage:f}=(0,a.useTracking)(),{startSection:D}=(0,a.useGuidedTour)(),E=(0,e.useRef)(D),{get:L,del:o}=(0,a.useFetchClient)();(0,e.useEffect)(()=>{E.current&&E.current("apiTokens")},[]),(0,e.useEffect)(()=>{T({search:x().stringify({sort:"name:ASC"},{encode:!1})})},[T]);const M=O.map(i=>({...i,metadatas:{...i.metadatas,label:s(i.metadatas.label)}})),{data:u,status:R,isFetching:ie}=(0,v.useQuery)(["api-tokens"],async()=>{f("willAccessTokenList");const{data:{data:i}}=await L("/admin/api-tokens");return f("didAccessTokenList",{number:i.length}),i},{enabled:r,onError(){d({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),U=r&&(R!=="success"&&R!=="error"||R==="success"&&ie),re=(0,v.useMutation)(async i=>{await o(`/admin/api-tokens/${i}`)},{async onSuccess(){await l.invalidateQueries(["api-tokens"]),f("didDeleteToken")},onError(i){i?.response?.data?.data?d({type:"warning",message:i.response.data.data}):d({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),de=r&&u,ce=r&&!u&&!c,ue=r&&!u&&c;return e.createElement(H.o,{"aria-busy":U},e.createElement(a.SettingsPageTitle,{name:"API Tokens"}),e.createElement($.T,{title:s({id:"Settings.apiTokens.title",defaultMessage:"API Tokens"}),subtitle:s({id:"Settings.apiTokens.description",defaultMessage:"List of generated tokens to consume the API"}),primaryAction:c?e.createElement(a.LinkButton,{"data-testid":"create-api-token-button",startIcon:e.createElement(P.default,null),size:"S",onClick:()=>f("willAddTokenFromList"),to:"/settings/api-tokens/create"},s({id:"Settings.apiTokens.create",defaultMessage:"Create new API Token"})):void 0}),e.createElement(F.D,null,!r&&e.createElement(a.NoPermissions,null),de&&e.createElement(a.DynamicTable,{headers:M,contentType:"api-tokens",rows:u,withBulkActions:m||g||r,isLoading:U,onConfirmDelete:i=>re.mutateAsync(i)},e.createElement(se,{canRead:r,canDelete:m,canUpdate:g,rows:u,withBulkActions:m||g||r})),ue&&e.createElement(a.NoContent,{content:{id:"Settings.apiTokens.addFirstToken",defaultMessage:"Add your first API Token"},action:e.createElement(Z.z,{variant:"secondary",startIcon:e.createElement(P.default,null)},s({id:"Settings.apiTokens.addNewToken",defaultMessage:"Add new API Token"}))}),ce&&e.createElement(a.NoContent,{content:{id:"Settings.apiTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})))},le=()=>e.createElement(a.CheckPagePermissions,{permissions:S.Z.settings["api-tokens"].main},e.createElement(oe,null))}}]);
