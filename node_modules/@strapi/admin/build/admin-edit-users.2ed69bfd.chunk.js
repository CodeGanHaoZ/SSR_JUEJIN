"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[4263],{34669:function(I,i,e){e.r(i),e.d(i,{default:function(){return re}});var t=e(32735),a=e(88425),s=e(5141),p=e(92891),r=e(72041),m=e(41925),n=e(5636),u=e(60216),d=e.n(u),g=e(88423),c=e.n(g),L=e(33795),U=e.n(L),R=e(9086),W=e.n(R),K=e(84968),T=e(83281),M=e(72850),D=e(41415),$=e(15335),F=e(5803),N=e(28356),j=e(17e3),O=e(49372),b=e(27649),Z=e(27677),w=e(29439),H=e(66456),z=e(64421);const y=async C=>{const{get:v}=(0,a.getFetchClient)(),{data:o}=await v(`/admin/users/${C}`);return o.data},q=async(C,v)=>{const{put:o}=(0,a.getFetchClient)(),{data:f}=await o(`/admin/users/${C}`,v);return f.data};var ee=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.username.label",defaultMessage:"Username"},name:"username",placeholder:{id:"Auth.form.username.placeholder",defaultMessage:"e.g. Kai_Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"global.password",defaultMessage:"Password"},name:"password",type:"password",size:{col:6,xs:12},autoComplete:"new-password"},{intlLabel:{id:"Auth.form.confirmPassword.label",defaultMessage:"Password confirmation"},name:"confirmPassword",type:"password",size:{col:6,xs:12},autoComplete:"new-password"}],[{intlLabel:{id:"Auth.form.active.label",defaultMessage:"Active"},name:"isActive",type:"bool",size:{col:6,xs:12}}]],te=e(1057),ae=e(4397),se=e(98399);const ne=(()=>window&&window.strapi&&window.strapi.isEE?e(28890).Z:e(16325).Z)(),Q=["email","firstname","lastname","username","isActive","roles"],X=C=>{let{canUpdate:v}=C;const{formatMessage:o}=(0,n.useIntl)(),{params:{id:f}}=(0,s.useRouteMatch)("/settings/users/:id"),{push:B}=(0,s.useHistory)(),{setUserDisplayName:V}=(0,a.useAppInfos)(),S=(0,a.useNotification)(),{lockApp:le,unlockApp:ie}=(0,a.useOverlayBlocker)();(0,a.useFocusWhenNavigate)();const{status:de,data:x}=(0,K.useQuery)(["user",f],()=>y(f),{retry:!1,keepPreviousData:!1,staleTime:1e3*20,onError(l){l.response.status===403&&(S({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}}),B("/")),se.log(l.response.status)}}),ce=async(l,E)=>{le();try{const h=await q(f,W()(l,"confirmPassword"));S({type:"success",message:o({id:"notification.success.saved",defaultMessage:"Saved"})});const P=a.auth.getUserInfo();if(f.toString()===P.id.toString()){a.auth.setUserInfo(h);const _=U()(l,"username")||(0,z.Pp)(l.firstname,l.lastname);V(_)}E.setValues(c()(l,Q))}catch(h){const P=(0,z.Iz)(h.response.data),_=Object.keys(P).reduce((G,A)=>(G[A]=P[A].id,G),{});E.setErrors(_),S({type:"warning",message:U()(h,"response.data.message","notification.error")})}ie()},J=de!=="success",me=J?{id:"app.containers.Users.EditPage.header.label-loading",defaultMessage:"Edit user"}:{id:"app.containers.Users.EditPage.header.label",defaultMessage:"Edit {name}"},Y=Object.keys(c()(x,Q)).reduce((l,E)=>E==="roles"?(l[E]=(x?.roles||[]).map(h=>{let{id:P}=h;return P}),l):(l[E]=x?.[E],l),{}),ue=Y.username||(0,z.Pp)(Y.firstname,Y.lastname),k=o(me,{name:ue});return J?t.createElement(b.o,{"aria-busy":"true"},t.createElement(a.SettingsPageTitle,{name:"Users"}),t.createElement(N.T,{primaryAction:t.createElement(D.z,{disabled:!0,startIcon:t.createElement(H.Z,null),type:"button",size:"L"},o({id:"global.save",defaultMessage:"Save"})),title:k,navigationAction:t.createElement(a.Link,{startIcon:t.createElement(w.Z,null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},o({id:"global.back",defaultMessage:"Back"}))}),t.createElement(j.D,null,t.createElement(a.LoadingIndicatorPage,null))):t.createElement(b.o,null,t.createElement(a.SettingsPageTitle,{name:"Users"}),t.createElement(T.Formik,{onSubmit:ce,initialValues:Y,validateOnChange:!1,validationSchema:te.YM},l=>{let{errors:E,values:h,handleChange:P,isSubmitting:_}=l;return t.createElement(a.Form,null,t.createElement(N.T,{primaryAction:t.createElement(D.z,{disabled:_||!v,startIcon:t.createElement(H.Z,null),loading:_,type:"submit",size:"L"},o({id:"global.save",defaultMessage:"Save"})),title:k,navigationAction:t.createElement(a.Link,{startIcon:t.createElement(w.Z,null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},o({id:"global.back",defaultMessage:"Back"}))}),t.createElement(j.D,null,x?.registrationToken&&t.createElement(M.x,{paddingBottom:6},t.createElement(ne,{registrationToken:x.registrationToken})),t.createElement(Z.K,{spacing:7},t.createElement(M.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(Z.K,{spacing:4},t.createElement(O.Z,{variant:"delta",as:"h2"},o({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"Details"})),t.createElement($.r,{gap:5},ee.map(G=>G.map(A=>t.createElement(F.P,(0,m.Z)({key:A.name},A.size),t.createElement(a.GenericInput,(0,m.Z)({},A,{disabled:!v,error:E[A.name],onChange:P,value:h[A.name]||""})))))))),t.createElement(M.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(Z.K,{spacing:4},t.createElement(O.Z,{variant:"delta",as:"h2"},o({id:"global.roles",defaultMessage:"User's role"})),t.createElement($.r,{gap:5},t.createElement(F.P,{col:6,xs:12},t.createElement(ae.Z,{disabled:!v,error:E.roles,onChange:P,value:h.roles}))))))))}))};X.propTypes={canUpdate:d().bool.isRequired};var oe=X,re=()=>{const C=(0,a.useNotification)(),v=(0,t.useMemo)(()=>({read:r.Z.settings.users.read,update:r.Z.settings.users.update}),[]),{isLoading:o,allowedActions:{canRead:f,canUpdate:B}}=(0,a.useRBAC)(v),{state:V}=(0,s.useLocation)(),S=(0,p.get)(V,"from","/");return(0,t.useEffect)(()=>{o||!f&&!B&&C({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}})},[o,f,B,C]),o?t.createElement(a.LoadingIndicatorPage,null):!f&&!B?t.createElement(s.Redirect,{to:S}):t.createElement(oe,{canUpdate:B})}},76779:function(I,i,e){var t=e(32735),a=e(60216),s=e.n(a),p=e(50563),r=e(88425),m=e.n(r),n=e(47765),u=e(59087),d=e.n(u),g=e(5636);const c=()=>t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg"},t.createElement("text",{transform:"translate(-23 -9)",fill:"#4B515A",fillRule:"evenodd",fontSize:"32",fontFamily:"AppleColorEmoji, Apple Color Emoji"},t.createElement("tspan",{x:"23",y:"36"},"\u2709\uFE0F"))),L=({children:U,target:R})=>{const W=(0,r.useNotification)(),{formatMessage:K}=(0,g.useIntl)(),T=()=>{W({type:"info",message:{id:"notification.link-copied"}})},M=K({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"});return t.createElement(r.ContentBox,{endAction:t.createElement(u.CopyToClipboard,{onCopy:T,text:R},t.createElement(p.h,{label:M,noBorder:!0,icon:t.createElement(n.Z,null)})),title:R,titleEllipsis:!0,subtitle:U,icon:t.createElement(c,null),iconBackground:"neutral100"})};L.propTypes={children:s().oneOfType([s().element,s().string]).isRequired,target:s().string.isRequired},i.Z=L},16325:function(I,i,e){var t=e(32735),a=e(5636),s=e(60216),p=e.n(s),r=e(463),m=e(76779);const n=({registrationToken:u})=>{const{formatMessage:d}=(0,a.useIntl)(),g=`${window.location.origin}${r.Z}auth/register?registrationToken=${u}`;return t.createElement(m.Z,{target:g},d({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};n.defaultProps={registrationToken:""},n.propTypes={registrationToken:p().string},i.Z=n},4397:function(I,i,e){var t=e(32735),a=e(60216),s=e.n(a),p=e(5636),r=e(70218),m=e(84967),n=e(84968),u=e.n(n),d=e(83292),g=e(27169),c=e(88425),L=e.n(c);const U=d.keyframes`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,R=d.default.div`
  animation: ${U} 2s infinite linear;
`,W=()=>t.createElement(R,null,t.createElement(g.Z,null)),K=async()=>{const{get:M}=(0,c.getFetchClient)(),{data:D}=await M("/admin/roles");return D.data},T=({disabled:M,error:D,onChange:$,value:F})=>{const{status:N,data:j}=(0,n.useQuery)(["roles"],K,{staleTime:5e4}),{formatMessage:O}=(0,p.useIntl)(),b=D?O({id:D,defaultMessage:D}):"",Z=O({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),w=O({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),H=O({id:"app.components.Select.placeholder",defaultMessage:"Select"}),z=N==="loading"?t.createElement(W,null):void 0;return t.createElement(r.P,{id:"roles",disabled:M,error:b,hint:w,label:Z,name:"roles",onChange:y=>{$({target:{name:"roles",value:y}})},placeholder:H,multi:!0,startIcon:z,value:F,withTags:!0,required:!0},(j||[]).map(y=>t.createElement(m.W,{key:y.id,value:y.id},O({id:`global.${y.code}`,defaultMessage:y.name}))))};T.defaultProps={disabled:!1,error:void 0},T.propTypes={disabled:s().bool,error:s().string,onChange:s().func.isRequired,value:s().array.isRequired},i.Z=T},1057:function(I,i,e){e.d(i,{YM:function(){return d},Rw:function(){return r}});var t=e(5173),a=e(88425);const s={firstname:t.Z_().trim().required(a.translatedErrors.required),lastname:t.Z_(),email:t.Z_().email(a.translatedErrors.email).lowercase().required(a.translatedErrors.required),username:t.Z_().nullable(),password:t.Z_().min(8,a.translatedErrors.minLength).matches(/[a-z]/,"components.Input.error.contain.lowercase").matches(/[A-Z]/,"components.Input.error.contain.uppercase").matches(/\d/,"components.Input.error.contain.number"),confirmPassword:t.Z_().min(8,a.translatedErrors.minLength).oneOf([t.iH("password"),null],"components.Input.error.password.noMatch").when("password",(g,c)=>g?c.required(a.translatedErrors.required):c)};var r={...s,currentPassword:t.Z_().when(["password","confirmPassword"],(g,c,L)=>g||c?L.required(a.translatedErrors.required):L),preferedLanguage:t.Z_().nullable()},n={roles:t.IX().min(1,a.translatedErrors.required).required(a.translatedErrors.required)},d=t.Ry().shape({...s,isActive:t.Xg(),...n})},28890:function(I,i,e){var t=e(32735),a=e(5636),s=e(60216),p=e.n(s),r=e(463),m=e(76779);const n=({registrationToken:u})=>{const{formatMessage:d}=(0,a.useIntl)();return u?t.createElement(m.Z,{target:`${window.location.origin}${r.Z}auth/register?registrationToken=${u}`},d({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})):t.createElement(m.Z,{target:`${window.location.origin}${r.Z}auth/login`},d({id:"app.components.Users.MagicLink.connect.sso",defaultMessage:"Send this link to the user, the first login can be made via a SSO provider."}))};n.defaultProps={registrationToken:""},n.propTypes={registrationToken:p().string},i.Z=n},27169:function(I,i,e){e.d(i,{Z:function(){return a}});var t=e(74512);function a(s){return(0,t.jsx)("svg",{width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s,children:(0,t.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.057 18c.552 0 1 .451 1 .997v4.006a1 1 0 01-.941.995l-.059.002c-.552 0-1-.451-1-.997v-4.006a1 1 0 01.941-.995l.06-.002zm-3.06-.736l.055.03c.478.276.64.89.367 1.364l-2.002 3.468a1 1 0 01-1.31.394l-.055-.03a1.002 1.002 0 01-.368-1.363l2.003-3.469a1 1 0 011.31-.394zm7.42.394l2.002 3.468a1 1 0 01-.314 1.331l-.053.033a1.002 1.002 0 01-1.365-.363l-2.003-3.469a1 1 0 01.314-1.33l.054-.034a1.002 1.002 0 011.364.364zm-9.548-2.66l.033.054c.276.478.11 1.091-.364 1.364L3.07 18.42a1 1 0 01-1.331-.314l-.033-.053a1.001 1.001 0 01.364-1.365l3.468-2.003a1 1 0 011.33.314zm11.79-.313l3.468 2.002a1 1 0 01.393 1.31l-.03.055c-.276.478-.89.64-1.363.367l-3.469-2.003a1 1 0 01-.394-1.309l.03-.055c.276-.479.89-.64 1.364-.367zm4.344-3.628a1 1 0 01.995.941l.002.06c0 .551-.451 1-.997 1h-4.006a1 1 0 01-.995-.942L18 12.057c0-.552.451-1 .997-1h4.006zm-18 0a1 1 0 01.995.941l.002.06c0 .551-.451 1-.998 1H.998a1 1 0 01-.996-.942L0 12.057c0-.552.451-1 .998-1h4.004zm17.454-5.059l.033.054c.277.478.11 1.091-.363 1.365l-3.469 2.002a1 1 0 01-1.33-.314l-.034-.053a1.002 1.002 0 01.364-1.365l3.468-2.003a1 1 0 011.331.314zM3.07 5.684l3.468 2.003a1 1 0 01.394 1.31l-.03.055c-.276.478-.89.64-1.364.367L2.07 7.417a1 1 0 01-.394-1.31l.03-.055c.276-.479.89-.64 1.364-.368zm14.926-4.008l.056.03c.478.276.64.89.367 1.364l-2.003 3.468a1 1 0 01-1.309.394l-.055-.03a1.002 1.002 0 01-.367-1.364l2.002-3.468a1 1 0 011.31-.394zm-10.58.394L9.42 5.538a1 1 0 01-.314 1.33l-.053.034a1.002 1.002 0 01-1.365-.364L5.684 3.07a1 1 0 01.314-1.331l.054-.033a1.002 1.002 0 011.365.364zM12.058 0c.552 0 1 .451 1 .998v4.004a1 1 0 01-.941.996L12.057 6c-.552 0-1-.451-1-.998V.998a1 1 0 01.941-.996l.06-.002z",fill:"#212134"})})}}}]);
